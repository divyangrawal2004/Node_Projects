<%- include('header') %>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

<div class="page-wrapper">
  <div class="page-breadcrumb">
    <div class="row">
      <div class="col-12 d-flex no-block align-items-center">
        <h4 class="page-title">Tables</h4>
        <div class="ml-auto text-right">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="#">Home</a></li>
              <li class="breadcrumb-item active" aria-current="page">Library</li>
            </ol>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-body d-flex justify-content-between align-items-center">
            <h5 class="card-title m-0">Admin Table</h5>
            <!-- 🔍 Search Form -->
            <form class="form-inline" method="get" action="/admin/viewPage">
              <div class="input-group">
                <input 
                  type="text" 
                  name="search" 
                  value="<%= typeof search !== 'undefined' ? search : '' %>" 
                  class="form-control" 
                  placeholder="Search by Name, Email, City" 
                  style="min-width: 250px;"
                >
                <div class="input-group-append">
                  <button class="btn btn-primary" type="submit">Search</button>
                </div>
              </div>
            </form>
          </div>

          <table class="table table-hover table-bordered mt-3">
            <thead class="thead-dark">
              <tr>
                <th>Id</th>
                <th>Image</th>
                <th>Name</th>
                <th>Email</th>
                <th>City</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <% adminData.map((val, index) => { %>
                <tr>
                  <td><%= ++index %></td>
                  <td><img src="/uploads/<%= val.profile %>" alt="Profile" width="50" height="50" class="rounded-circle"></td>
                  <td><%= val.name %></td>
                  <td><%= val.email %></td>
                  <td><%= val.city %></td>
                  <td>
                    <a href="/admin/deleteAdmin/<%= val._id %>" class="text-danger mr-2"><i class="mdi mdi-delete"></i></a>||
                    <a href="/admin/editAdmin/<%= val._id %>" class="text-warning mr-2"><i class="mdi mdi-table-edit"></i></a>||
                    <a href="#ex1" rel="modal:open" onclick="return singleAdmin('<%= val._id %>')" class="text-info"><i class="mdi mdi-eye"></i></a>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="ex1" class="modal" style="max-width: 500px; border-radius: 10px; padding: 20px;">
  <div class="text-center mb-3">
    <div id="profilePic" class="mb-2"></div>
    <h4 id="adminFullName" class="font-weight-bold"></h4>
  </div>
  <hr>
  <p><strong>Email:</strong> <span id="adminEmail"></span></p>
  <p><strong>Gender:</strong> <span id="adminGender"></span></p>
  <p><strong>Qualification:</strong> <span id="adminQualification"></span></p>
  <p><strong>City:</strong> <span id="adminCity"></span></p>
  <p><strong>Message:</strong> <span id="adminMessage"></span></p>
  <div class="text-right">
    <a href="#" rel="modal:close" class="btn btn-secondary">Close</a>
  </div>
</div>

<%- include('footer') %>
<script>
  function singleAdmin(id) {
    $.ajax({
      url: '/admin/singleAdmin/' + id,
      type: 'post',
      success: function(res) {
        if (res.status === 'success') {
          const data = res.data;
          $('#profilePic').html(`<img src="/uploads/${data.profile}" width="120" height="120" class="rounded-circle border shadow">`);
          $('#adminFullName').text(data.name);
          $('#adminEmail').text(data.email);
          $('#adminGender').text(data.gender);
          $('#adminQualification').text(Array.isArray(data.qualification) ? data.qualification.join(', ') : (data.qualification || '-'));
          $('#adminCity').text(data.city || '-');
          $('#adminMessage').text(data.message || '-');
        } else {
          alert('Error fetching admin details');
        }
      },
      error: function(err) {
        console.error(err);
        alert('Something went wrong!');
      }
    });
  }
</script>
